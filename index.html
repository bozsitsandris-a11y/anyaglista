<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Anyaglista – Gyors DB</title>
  <style>
    :root{--bg:#0f0f10;--card:#161618;--muted:#8a8a8e;--text:#f5f5f7;--accent:#d4af37;--danger:#ff4d4d;}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .wrap{max-width:900px;margin:0 auto;padding:18px}
    header{display:flex;align-items:center;gap:10px;justify-content:space-between;margin-bottom:14px}
    h1{font-size:20px;margin:0}
    .badge{font-size:11px;color:var(--bg);background:var(--accent);padding:2px 8px;border-radius:999px}
    .row{display:flex;gap:8px;align-items:center}
    input,button{border:none;outline:none}
    .card{background:var(--card);border:1px solid #222;border-radius:14px;padding:12px}
    .controls{display:grid;grid-template-columns:1.3fr 0.8fr 0.8fr auto;gap:8px}
    .controls input{background:#0e0e10;color:var(--text);padding:12px;border-radius:12px}
    .controls button{padding:12px;border-radius:12px;background:var(--accent);color:#111;font-weight:700}
    .list{margin-top:14px;display:grid;gap:8px}

    /* ELEMEK ELRENDEZÉSE */
    .item{
      display:grid;
      grid-template-columns:minmax(220px,1fr) auto auto auto 36px; /* több hely a névnek */
      gap:8px;align-items:center;background:#111;border:1px solid #232326;border-radius:12px;padding:10px
    }

    /* A NÉV NE VÁGÓDJON LE */
    .name{
      font-weight:600;
      white-space:normal;       /* TÖRDELHETI a hosszú neveket */
      overflow:visible;
      text-overflow:clip;
      word-break:break-word;    /* ha kell, tördje a szavakat is */
      line-height:1.25;
    }

    .qty{display:flex;align-items:center;gap:8px}
    .qty input{width:70px;text-align:center;background:#0c0c0e;color:var(--text);padding:8px;border-radius:10px}
    .item button{padding:6px 10px;border-radius:10px;background:#1e1e22;color:var(--text)}
    .item .icon{font-weight:900}
    .footer{margin:26px 0 10px;color:var(--muted);font-size:12px}
    .tools{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .tools button{padding:10px 12px;border-radius:10px;border:none;cursor:pointer}
    .primary{background:var(--accent);color:#111;font-weight:700}
    .danger{background:var(--danger);color:#fff}
    .search{display:flex;gap:8px;margin-top:10px}
    .search input{flex:1;background:#0e0e10;color:var(--text);padding:12px;border-radius:12px}
    .checkbox{display:flex;align-items:center;gap:10px;color:var(--muted);font-size:13px;margin-top:8px}

    /* MOBILON MÉG TÖBB HELY A NÉVNEK */
    @media (max-width:768px){
      .item{grid-template-columns:minmax(260px,1fr) auto auto auto 36px;}
      .name{font-size:15px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="row">
        <h1>Anyaglista</h1>
        <span class="badge">offline</span>
      </div>
    </header>

    <div class="card">
      <div class="controls">
        <input id="name" placeholder="Anyag neve (pl. 7.61 festék)" autocomplete="off">
        <input id="qty" type="number" inputmode="numeric" placeholder="Darab">
        <input id="note" placeholder="Megjegyzés">
        <button id="addBtn">Hozzáad</button>
      </div>
      <div class="search">
        <input id="search" placeholder="Keresés név / megjegyzés szerint…">
        <button id="exportBtn">CSV</button>
      </div>
      <label class="checkbox"><input type="checkbox" id="hideZero"> 0 darabos tételek elrejtése</label>
      <div class="tools">
        <button id="shareBtn" class="primary">Megosztás</button>
        <button id="copyBtn">Másolás</button>
        <button id="resetBtn" class="danger">Minden törlése</button>
      </div>
    </div>

    <div id="list" class="list"></div>

    <div class="footer">© Galambos Hair – Anyaglista</div>
  </div>

<script>
const $ = s => document.querySelector(s);
const listEl = $('#list');
const nameEl = $('#name');
const qtyEl = $('#qty');
const noteEl = $('#note');
const searchEl = $('#search');
const hideZeroEl = $('#hideZero');

let data = JSON.parse(localStorage.getItem('anyaglista_v1') || '[]');

function save(){ localStorage.setItem('anyaglista_v1', JSON.stringify(data)); }

function addItem(name, qty, note=""){
  if (!name) return;
  const ex = data.find(d => d.name.trim().toLowerCase() === name.trim().toLowerCase());
  if (ex){ ex.qty = Number(ex.qty||0) + Number(qty||0); if (note) ex.note = note; }
  else data.unshift({id:Date.now()+Math.random(), name:name.trim(), qty:Number(qty||0), note:note.trim()});
  save(); render();
}

function updateQty(id, val){
  const it = data.find(x=>x.id===id);
  if(!it) return;
  it.qty = Math.max(0, Number(val||0));
  save(); render(false);
}

function removeItem(id){
  data = data.filter(x=>x.id!==id);
  save(); render();
}

function filtered(){
  const q = searchEl.value.trim().toLowerCase();
  return data.filter(it => {
    const match = !q || it.name.toLowerCase().includes(q) || (it.note||'').toLowerCase().includes(q);
    const zeroOk = !hideZeroEl.checked || Number(it.qty)>0;
    return match && zeroOk;
  });
}

function render(){
  const items = filtered();
  listEl.innerHTML = '';
  if(items.length===0){
    listEl.innerHTML = '<div style="opacity:.6;padding:16px;text-align:center;">Nincs tétel</div>';
    return;
  }
  for(const it of items){
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <div class="name">${escapeHtml(it.name)}${it.note?`<div style='font-size:12px;color:#aaa'>${escapeHtml(it.note)}</div>`:''}</div>
      <div class="qty">
        <button data-act="dec" class="icon">−1</button>
        <input type="number" value="${Number(it.qty)}">
        <button data-act="inc" class="icon">+1</button>
      </div>
      <button data-act="zero">0</button>
      <button data-act="del">✕</button>
    `;
    const input = div.querySelector('input');
    input.addEventListener('change', e => updateQty(it.id, e.target.value));
    div.querySelector('[data-act="inc"]').onclick = ()=>updateQty(it.id, Number(it.qty)+1);
    div.querySelector('[data-act="dec"]').onclick = ()=>updateQty(it.id, Math.max(0, Number(it.qty)-1));
    div.querySelector('[data-act="zero"]').onclick = ()=>updateQty(it.id, 0);
    div.querySelector('[data-act="del"]').onclick = ()=>{ if(confirm('Törlöd?')) removeItem(it.id); };
    listEl.appendChild(div);
  }
}

function asText(list){
  if(list.length===0) return 'Üres lista';
  return list.map(it => `• ${it.name} — ${it.qty} db${it.note?` (${it.note})`:''}`).join('\n');
}

function exportCSV(){
  const rows = [['Név','Darab','Megjegyzés']].concat(data.map(it => [it.name, it.qty, it.note||'']));
  const csv = rows.map(r => r.map(v => `"${String(v).replaceAll('"','""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'anyaglista.csv';
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

$('#addBtn').addEventListener('click', ()=>{
  addItem(nameEl.value, qtyEl.value, noteEl.value);
  nameEl.value=''; qtyEl.value=''; noteEl.value='';
  nameEl.focus();
});

$('#shareBtn').addEventListener('click', ()=>{
  const text = asText(filtered());
  if(navigator.share){ navigator.share({text}); }
  else { navigator.clipboard.writeText(text).then(()=>alert('Kimásoltam a vágólapra.')); }
});

$('#copyBtn').addEventListener('click', async ()=>{
  const text = asText(filtered());
  await navigator.clipboard.writeText(text);
  alert("Lista kimásolva!");
});

$('#resetBtn').addEventListener('click', ()=>{
  if(confirm('Biztosan törlöd az egész listát?')){
    data=[]; save(); render();
  }
});

$('#exportBtn').addEventListener('click', exportCSV);
searchEl.addEventListener('input', ()=>render());
hideZeroEl.addEventListener('change', ()=>render());

render();
</script>
</body>
</html>